#!/usr/bin/env python
# coding: utf-8

# In[1]:


import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns
import plotly.express as px
import random as random


# In[2]:


df=pd.read_csv('checkpoint_3.csv')
df['ListingByYear'] = df.apply(lambda row: row.month[:4], axis = 1)

display(df)


# In[3]:


bpbytown=df.boxplot(by ='town', column =['resale_price'], grid = False, figsize =(15, 10))

plt.xticks(rotation=90)
plt.show()


# In[4]:


meanleasebyyear = df.groupby(['ListingByYear']).aggregate(np.mean)

plt.clf()
plt.figure(figsize=(15,10))
plt.scatter(meanleasebyyear.index,meanleasebyyear['resale_price'])
plt.title('Mean Price vs Listing By Year')
plt.ylabel('Mean Price')
plt.xlabel('Listing By Year')
plt.show()

leasebyyear=df.boxplot(by ='ListingByYear', column =['resale_price'], grid = False, figsize =(15, 10))
plt.xticks(rotation=90)
plt.show()

# display(meanleasebyyear)


# In[5]:


meanleasebymonth = df.groupby(['month']).aggregate(np.mean)

plt.clf()
plt.figure(figsize=(15,10))
plt.scatter(meanleasebymonth.index,meanleasebymonth['resale_price'])
plt.title('Mean Price vs Listing By Month')
plt.ylabel('Mean Price')
plt.xlabel('Listing By Month')
plt.xticks(rotation=90)
plt.show()

leasebymonthbp=df.boxplot(by ='month', column =['resale_price'], grid = False, figsize =(15, 10))
plt.xticks(rotation=90)
plt.show()

# display(meanleasebyyear)


# In[6]:


#Getting the storey_range and town graphs
df2017=df.loc[df['ListingByYear']=='2017']
# print(df2017['month'].unique())
meanpricebystorey = df2017.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2017)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[7]:


#Getting the storey_range and town graphs
df2018=df.loc[df['ListingByYear']=='2018']
print(df2018['month'].unique())
meanpricebystorey = df2018.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2018)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[8]:


#Getting the storey_range and town graphs
df2019=df.loc[df['ListingByYear']=='2019']
print(df2019['month'].unique())
meanpricebystorey = df2019.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2019)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[9]:


#Getting the storey_range and town graphs
df2020=df.loc[df['ListingByYear']=='2020']
print(df2020['month'].unique())
meanpricebystorey = df2020.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2020)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[10]:


#Getting the storey_range and town graphs
df2021=df.loc[df['ListingByYear']=='2021']
print(df2021['month'].unique())
meanpricebystorey = df2021.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2021)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[11]:


#Getting the storey_range and town graphs
df2022=df.loc[df['ListingByYear']=='2022']
print(df2022['month'].unique())
meanpricebystorey = df2022.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.scatter(newdf.index, newdf[i], label=i)
    plt.plot(newdf.index, newdf[i], '-o')


plt.title('Mean Price vs Storey Range (2022)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[12]:


#Getting the storey_range and town graphs
df2023=df.loc[df['ListingByYear']=='2023']
print(df2023['month'].unique())
meanpricebystorey = df2023.groupby(['storey_range','town']).aggregate(np.mean)
# display(meanpricebystorey['resale_price'])

newdf=meanpricebystorey['resale_price'].unstack(level=1)
# display(newdf)
# print(newdf.index)

#Plot the graphs
plt.clf()
plt.figure(figsize=(15,10))
#Taking it by storey range
for i in newdf.columns:
    plt.plot(newdf.index, newdf[i])
    plt.scatter(newdf.index, newdf[i], label=i)
    


plt.title('Mean Price vs Storey Range (2023)')
plt.ylabel('Mean Price')
plt.xlabel('Storey Range')
plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
# plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
plt.xticks(rotation=90)
plt.show()

# plt.figure(figsize=(15,10))
# for i in newdf.index:
#     plt.scatter(i,newdf[i])

# plt.show()
# display(meanleasebyyear)


# In[31]:


#Getting the street name and town graphs by year
changey={2017:df2017,2018:df2018,2019:df2019,2020:df2020,2021:df2021,2022:df2022, 2023:df2023}
whatyear=2017

y=changey[whatyear]
uniquetown=y['town'].unique()
print(y['month'].unique())

for i in uniquetown:
    bystreetdf=y.loc[df['town']==i] 
#     pricebystreet=bystreetdf.groupby('street_name')
#     display(pricebystreet)
#     newdf=pricebystreet['resale_price']
#     newdf=pricebystreet['resale_price'].unstack(level=1)
#     display(newdf)
    
    #plot the graph
    plt.clf()
    bystreetbp=bystreetdf.boxplot(by ='street_name', column =['resale_price'], grid = False, figsize =(15, 10))
#     plt.scatter(pricebystreet.index,pricebystreet['resale_price'])

    #Put aesthetics on graph
    plt.title(f'Resale Price vs Street ({whatyear}/{i})')
    plt.ylabel('Resale Price')
    plt.xlabel('Street')
#     plt.legend(loc='center left', bbox_to_anchor=(1, 0.5))
    # plt.legend(loc='upper center', bbox_to_anchor=(0.5, 1.05),ncol=6, fancybox=True, shadow=True)
    plt.xticks(rotation=90)
    plt.show()


# In[ ]:




